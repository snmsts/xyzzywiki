* 起動時、スクラッチ・ファイル表示時、このファイル画面の左上が「**scratch*」と表示される [#wa1040c5]
-ページ: [[質問箱]]
-投稿者: [[Miteba]]
-状態: 提案
-投稿日: 2005-07-29 12:49:19 (金)

** メッセージ [#tcb42d40]
起動時、スクラッチ・ファイル表示時、このファイル画面の左上が「**scratch*」と表示される点、原因が特定できません――たぶん、初級者的なみおとしからくるのかもしれませんが……

　この＜はじめてのxyzzy＞で＜単語検索：「scratch」 ないし、「スクラッチ」＞で検索して６カ所の該当箇所をみたのですが、上記症状に該当するヒントはありませんでした。また、『入門xyzzy』の索引には、欧字索引も日本語索引にもみあたりません。この本の頁をいろいろめくってみているのですが……

　ちなみに、.xyzzyの最後の行に、（howm-menu）　　　と記述すると、*howmM:%memu% のファイル画面が最後に現れると思いきや、*howmM:%memu% が一瞬画面にみえたあとに、「**scratch*」の画面が最後に出てきます。

　*howmM:%memu% 　のファイル画面はでてきているのですが、あとから、「**scratch*」画面がでてきて置き換わってしまいます――しかたなく、画面左上のもっとも左にある「*howmM:%memu% 」をクリックすると、画面がきりかわるわけですが……。

　どうも、scratchが二回呼び出されているような感じなのですが。
----
-「スクラッチ・ファイル」とは *scratch* バッファのことでしょうか。左上というのはバッファタブ？とりあえず起動直後に undo してみたら何かわかるかもしれません。 --  &new{2005-07-29 15:22:07 (金)};
-　起動後にundoしてみましたが、以下の通りでした――なお、スクラッチ・ファイル」＝ *scratch* バッファ、左上＝buffer bar（バッファタブ）~
――Undoをおこなっても、**scratch*のままです。.xyzzy の最後の行に　(howm-menu) を書き加えている場合で症状を記します……~
buffer-barに顕れるbuffer-tab、は、左から、　*howmM:c:/home/howm/.howm-menu* 、　その右（つまり一番右側）に、**scratch*　です。　　そして、ウィンドウ画面は、**scratch*です。――本当は、これでは困るわけです。.xyzzyの最後の行に　(howm-menu) 　を書きくわえたのだから buffer-tab==*howmM:c:/home/howm/.howm-menu* がウィンド画面になってくれないことには……。~
この時点で、Undo（C+z）をおこなうと、なにも変化がおこらず、ウィンドウ画面はやはり、**scratch*　のままです。~
もちろん、ここで、buffer-bar上の*howmM:c:/home/howm/.howm-menu* をマウスでクリックすると、ウィンドウ画面は、*howmM:c:/home/howm/.howm-menu* に切り替わります。
　今度は、.xyzzy に以下を追加記述~
 ;; *scratch* ==終了時保存
 (add-hook '*kill-xyzzy-hook*
 #'(lambda ()
 (set-buffer (find-buffer "*scratch*"))
 (write-file "~/scratch")))

それでも、やはり、**scratch*　と**　がつく症状、および、*howmM:c:/home/howm/.howm-menu* をおさえて、ウィンドウ画面が**scratch*になってしまう症状は変わりません。

なお、この症状と相互関連しているのかどうかわからないのですが、.xyzzyにさらに以下を追加記述すると

　;; *scratch* ==起動時ロード
 (add-hook '*post-startup-hook*
 #'(lambda ()
 (set-buffer (find-buffer "*scratch*"))
 (insert-file "~/scratch")))

すると、**scratch*に保存されている内容が次回xyzzy起動時に二重化されて保存内容が増殖していきます。（なお、.xyzzyに、上記　＜;; *scratch* ==起動時ロード＞をさらにもう一連書き加えますと、xyzzy起動時に、やはり**scratch*が顕れました。　また、いったんxyzzy終了後にまた再起動すると、今度は三重化保存された内容の**scratch*が顕れました）~
ここで、undoを　かけてみると、**scratch*保存内容（起動のたびにどんどん二重化された内容で保存されていた）が全部きえ、しかも、びっくりしたことに、buffer-tabの、**scratch*　が、　*scratch*　つまり、正常な表示にきりかわりました（「*」がひとつとれて、「*scratch*」に変わりました）。~
その後に、xyzzyを起動してみましたが、やはり、**scratch*が顕れることはかわりませんし、また、なにも書いていない空白の、、**scratch*に対しては、undo自体がきかない（「これ以上、アンドーできません」とpop-uped表示） 
――標準的設定にしている他のxyzzyに上記＜;;*scratch* ==終了時保存＋;;*scratch* ==起動時ロード＞部分を.xyzzyに書き加えて再起動したところ、**scratch*でなくて、正常なバッファー・タブの*scratch*、ウィンド画面は*howmM:c:/home/howm/.howm-menu* 、*scratch*の保存内容の二重化増殖は起こりませんでした。 　　　　それでは、標準的設定の.xyzzyと今回の問題症状をよぶときの.xyzzyとどこがちがうのか、というのをいま見比べているのですが、まだ原因がわからないため、とりあえず、*scratch*ではなく、 **scratch*というバッファータブが生じる意味、生じる典型的な原因はどのようなものかを過去の蓄積や経験のあるxyzzy専門家にお訊きしたいのですが -- [[Miteba]] &new{2005-07-30 13:20:09 (土)};
-**scratch*ってバッファ名*scratch*を書き換えた時に*が足されてるだけだと思うけどなぁ立ち上げ時に*scratch*の中身書き換えてるなら正常じゃないの？ --  &new{2005-07-30 17:14:42 (土)};
-「~/.xyzzy」に直接(howm-menu)を記述するのはあんまりいいやり方ではないので、うまくいかないことがあるのはそういうものです。コマンドラインオプションでやるか、*post-startup-hook*に引っ掛けて最後に実行されるようにするべきでしょうね。 -- [[NANRI]] &new{2005-07-30 19:14:46 (土)};
-どうもありがとうございました。コマンドラインオプションというやりかたはうまくできませんでしたが……――初心者的であるため＋『入門xyzzy』には載っていない（xyzzy release note:http://www.jsdlab.co.jp/~kei/download/00README.htmlをみて、xyzzy.batファイルをつくって、
 xyzzy[-load c:/home/howm/.howm-menu]
となどしましたが、xyzzyが起動するものの、loadされません）。　そこで、「post-startup-hook*に引っ掛けて」という助言のほうの意味を、.xyzzy内容や『入門xyzzy』をめくって推測し、見当がつきましたので以下を、.xyzzyに書き加えました。
 (add-hook '*post-startup-hook*
 #'(lambda ()
 (set-buffer (find-buffer "*howmM*"))
 (insert-file "c:/home/howm/.howm-menu")))
とすると、たしかに、.howm-menuが、バッファー・タブ*howmM:c:/home/howm/.howm-menu*が、ウィンドウ画面としてload されました。結果allrightで、上記の記述でよいと考えてていいでしょうか。しかも、**scratch* ではなくて、*scratch* という正常なかたちで、バッファーbar に表示されました。――――これで現象的には解決したともいえるのですが、ひとつだけ、不都合なエラー表示が起動時にでます：「書き込み禁止バッファーです」というエラー表示です。しかも、このエラー表示に対して、pop窓の「OK」をクリックしないと＜砂時計＞が消えません。つまり、xyzzyを使うまえに、このエラー表示にとにかく退散願わないと、はじまらないわけです。――――ともあれ、前述の**scratch*が顕れる原因は、わからないままです――というのは、問題症状のまったくなかった標準的.xyzzyのXYZZYと、今回の問題症状を示すxyzzyを比較ししたところ、.howm-init.lは実質同じ、howm-pre-init.lはまったく同じ、.xyzzyのところが問題症状を示すほうのxyzzyには、メモファイル切り換えるためのhowm用の記述が書き加えられているだけで、あとは、いろいろ一時的に＜；＞で無効にしてみたり、.xyzzyのhowm関係指定を.howm-init.l に移行されてみても、症状が消えなかったからです。 -- [[Miteba]] &new{2005-07-31 14:22:44 (日)};
-howm のことは詳しくありませんが、(add-hook '*post-startup-hook* 'howm-menu) がいいような気がします。 --  &new{2005-07-31 16:33:55 (日)};
-書込み禁止ということは、 *howmM* に移動したあとでなんかバッファに書き込もうとしてますね。*post-startup-hook* に入ってるなにかが原因かな？ --  &new{2005-07-31 16:52:52 (日)};
-どうもありがとうございました。「、(add-hook '*post-startup-hook* 'howm-menu) 」の件は、＜２＞で経過をのべます。
＜１＞まず、＜[[Miteba]] &new{2005-07-31 14:22:44 (日)＞では、申し訳ないことに、ひとつ見落としがありました。うっかりして、howm-init.l の最後の行にも「(howm-menu)」を記述していたのを削除しないままでやっていました。そこで、このhowm-init.lの最終行「(howm-menu)」を削除して、あらためて起動してみましたところ――バッファー・タブ*howmM:c:/home/howm/.howm-menu*が、ウィンドウ画面としてload されました状態のときに（ただし、バッファーbarはまったく見えない状態で）、エラー表示「変数が定義されていません：のみの書き加えでは、**scratch*」が出ます。このpopウィンドウの＜OK＞をクリックすると、ウィンドウ画面が**scratch*に変わってしまうことがわかりました。そこで、.xyzzyにさらに、（howm-menu）を再度書き加えるて起動。すると、まったくおなじ結果になりました（エラー表示「変数が定義されていません：のみの書き加えでは、**scratch*」が出ます。このpopウィンドウの＜OK＞をクリックすると、ウィンドウ画面が**scratch*に変わってしまう）。今度は、その「（howm-menu）」をhowm-init.lの最後の行に移動して再起動。やはり同じ結果でした。次に、「（howm-menu）」をhowm-init.lの最後の行から再削除して再起動。それでもまったく同じ感じです（howm-init.lに記述するときは、＜砂時計＞がながい感じがありますが……）。　　最後に、.xyzzy  にも、.howm-init.lにも両方に、「(add-hook '*post-startup-hook*」「 #'(lambda ()　 (set-buffer (find-buffer "*howmM*"))　」「 (insert-file "c:/home/howm/.howm-menu")))」を書いた状態で起動すると、エラー表示「「変数が定義されていません：のみの書き加えでは、**scratch*　」｛　*scratch*　ではなくて、**scratch*｝」が表示され、OKクリックすると、さらにエラー表示「書き込み禁止バッファーです」というそもそも＜[[Miteba]] &new{2005-07-31 14:22:44 (日)＞で言及した表示がさらに出てきて、そのOKをクリックすると、なんと、正常な。バッファータブ*howmM:c:/home/howm/.howm-menu*がウィンドウ画面に表示されて終わります。バッファーbarをみると、もっとも左に*howmM:c:/home/howm/.howm-menu*、そして、その右に、なんと　*scratch* (**scratch* ではなく)が表示されています。　　-- [[Miteba]] &new{2005-07-31 18:26:37 (日)};

#comment
