#freeze
*Installer for xyzzy. [#hcf8d9df]

xyzzyの拡張もののInstallerを作ろうかと思ってるのですが、誰かすでにやってる人います？
-Installer of xyzzy
ならつくりかけのものがあります。公開する気は今のところ無いですが。
ところでプラットフォームはxyzzyですか？それともexeになるんですか？（佐野
-とりあえずxyzzyでと。
新規にxyzzyを入れてから環境を作り上げるまでが大変なので、なんとかならないものかと思って。
-一度出来てしまえばコピーするだけなんですがねぇ。ただそれだとインストーラを使ったユーザはあまり設定の仕方を覚えないだろうから、アップデータとかも兼ねておかないとあんまりおいしくないような気がします。ここで仕様を決めながら作っていってもいいかもしれませんね。（佐野
-できれば、アップデータも兼ねたいなと。MeadowのNet Installとまではいかなくても。
あと設定を自動でするのはヤバそうなのでそれは手動でとか。( http://web.archive.org/web/20111228100526/http://www.netlaputa.ne.jp/~kose/Emacs/Meadow/index.html#netinstall )
-やばいでしょうか？インストーラが直接.xyzzyやsiteinit.l(c)をいじるのはまずいにしても、設定ファイルに参照を追加して、インストーラ独自のファイルはインストーラがいじるとかにすれば概ね問題は回避できるかと思います。というかそうしないとあんまりありがたみが無いかと思います。（佐野
-ウィルスマクロ作るの簡単そうなのでヤバいかと思ったんですが、どうでしょうか。
-ちなみに考えてるのはこんな感じ。
--配布者に配布物リストを置いてもらう
--それを持ってきて、リストを表示
--入れたいものをマーク
--インストール／アップデート
-難点はこんな感じ。
--配布者にリストを作ってもらわないといけない
--多分配布物の作り方も合わせてもらわないといけない
-ウィルスマクロに関して
設定するファイルのリストを''誰でもが''自由に書けるという状態でなければ大丈夫かと思います。caldix( http://www.kmonos.net/lib/caldix.html )の管理を見ていもおおもとの管理さえまともであれば十分いけると思います。
-ファイルリストについて

個々の配布者に負担のかかる形式は良くないと思います。
いくつのパッケージを収録するのか知りませんが、確率的にも絶対最新には更新されなくなります。（リスト生成用のマクロも作るなら話は変わってきますが。
僕が考えていたリストのエレメントは
--URL
--解凍すべき場所
--更新（確認）日時

それぞれのパッケージの依存関係を除いてしまえばこれ位なのですが最新情報はwikiにユーザ（作者でももちろんかまわない）が書き込んでそれをインストーラの管理者が確認して取り込む位が良いかと思います。
リスクを恐れない人はwikiの情報をそのまま使うことも出来るとかにしておけば良いかと。
（佐野
-私は逆にどこかでまとめて管理するとそこに負担と責任がかかりすぎるかなと思います。
なので配布者がそれぞれできる範囲でという感じで考えてました。（つまり最初は私の自分の分だけ）

考えていたリストの要素は、
--サイト名
--パッケージ名
--Author
--バージョン
--更新日時
--md5sum
--パッケージの概略説明

-負担と責任は常に悩ましいところですねぇ。でもそれだけ仕様が固まっているなら実装にかかっちゃってもいいんじゃないですか？（佐野
-ええ。かかろうかなと思ってるんですが、念のため誰かすでに作りかかってないか確認しておこうかと思って。
-とりあえず作ってみました。暇な人は試してみて下さい。
--http://www.mirai.ne.jp/~gyo/xyzzy/ni.html

----
-"a" => "http://www.mirai.ne.jp/~gyo/xyzzy/packages.l" を行っても登録されないようです。大久保
- "ALL Sites"の次の行で"a"したら登録できました。 山本
-ありがとうございます。無事できました。大久保
----
-インストールを実行したら、「D:/xyzzy/.netinst/src/ 指定されたパスがみつかりません。」といわれてしまいましたが、install.l をバイトコンパイルしなおしたらうまくいったみたいです。 ひえ
--うーん。なんででしょう？ どなたか再現したときに *Trace Output* 見せてください。 服部
--ぼくのところでも同じような現象がありました。とりあえず、*Trace Output*をとったので、のせておきます。ちなみに、lcファイルをすべて削除してみると、問題なく動きました。また、install.lを再byte-compileしてもうまく動くようになります。（ありま）
 >CALL STACK 10: (create-directory "D:/xyzzy/.netinst/src/")
 >CALL STACK  9: (system:*byte-code ...)
 >CALL STACK  8: (netinst::http-get-to-file "http://www.mirai.ne.jp/~gyo/xyzzy/download.cgi?rss-0.0.1.1.lzh" "D:/xyzzy/.netinst/src/rss-0.0.1.1.lzh")
 >CALL STACK  7: (system:*byte-code ...)
 >CALL STACK  6: (netinst::install-app-fetch (("site" . "Junk Scripts") ("name" . "rss-mode") ("version" . "0.0.1.1") ...))
 >CALL STACK  5: (system:*byte-code ...)
 >CALL STACK  4: (netinst::install-app (("site" . "Junk Scripts") ("name" . "rss-mode") ("version" . "0.0.1.1") ...))
 >CALL STACK  3: (system:*byte-code ...)
 >CALL STACK  2: (#<lexical-closure: netinst::app-install-current>)
 >CALL STACK  1: (command-execute netinst::app-install-current)
 D:/xyzzy/.netinst/src/
 デバイスの準備ができていません。 
---ありがとうございます。たぶん直しました。 服部

----
-それから、本体ではないですが、packages.lの一部が間違っているような気がします。xml-parser-modokiのURLは、"www.mirai.ne.jp/xyzzy"ではなくて、"www.mirai.ne.jp/~gyo/xyzzy"ではないでしょうか。あと、rss-modeをインストールしようとすると、"md5sumが一致しません"というエラーが出ます。（ありま）
--すみません。こちらも直しました。 服部

----
-Netinstaller でinstallできるようにしようと試みているのですが、install しようとすると
C:/xyzzy/site-lisp, C:/xyzzy/site-lisp/techex を上書きしてもよいですか？
という警告が出てしまい、つまっております。
~.netinst/src/techex.files には、"site-lisp/"とか"site-lisp/techex/"が出来ているみたいです。
なにがまずいのか教えていただけないでしょうか？
packages.l は  http://www5e.biglobe.ne.jp/~fukafuka/xyzzy/packages.l です。ふかえ
--作成したアーカイブを xyzzy のファイラで V して、その中に site-lisp/hoge/ とかあるとそうなる気がします。xyzzy でアーカイブを作成するとそうなるようですが、Lhut32 だとそうならなかったので上書きの確認はでなくなりました。 ひえ
--手でインストールしているものを、NetInstallerで最初に入れるときには上書き確認が出ます。
NetInstallerでバージョンアップや再インストールするときは、前回インストールしたファイルを削除してから解凍するので出なくなります。 服部
-->ひえさん、explzhでlh5という方式で圧縮しました。Lhut32もためしてみましたがだめでした。unlha32.dll の ver は 1.86.3.6 です。>服部さん、説明不足でした。fileでなく、folderの上書きの確認が出てしまうのですが。(^_^;ふかえ
---xyzzy の場合、圧縮する場所と基準ディレクトリを変えると、できあがったアーカイブにディレクトリ情報が取り込まれるか否かが変わるみたいです。例えば、c:\foo\bar\ 以下のファイルからアーカイブを作成する場合、ファイラで c:\foo\ フォルダから bar を選択して基準ディレクトリを c:\foo\ とするのと、c:\foo\bar\ ディレクトリから全てのファイルを選択して基準ディレクトリを c:\foo\ とするのでは、前者はディレクトリ情報有、後者はディレクトリ情報無となるみたいです。なので、後者の方法で作成するとうまくいくかもです。 ひえ
---上記の方法でも、techex のような構成だと、site-lisp/techex/ は、できてしまいますね。どうすると xyzzy からディレクトリ情報(？)をもたないアーカイブが作成できるのでしょう？ Lhut32 だと、右クリック→「書庫を作成」→ディレクトリ付 ON、「共通設定」フォルダ圧縮のパスは絶対パス OFF、「LHAの設定」圧縮方式 lha5 あたりでディレクトリ情報(？)を持たないものができてるみたいですが。unlha32.dll は、ふかえさんと同じバージョンです。 ひえ
---Lhut32ではできました。(^o^) explzhやxyzzy filerでもできると助かるのですがわかりませんでした。調べて頂いてありがたいです。ふかえ
---今更ですが、xyzzy では、Lha 形式アーカイブの作成/追加の命令、オプションには、a -d1n が使われてるみたいなので、ディレクトリの属性とタイムスタンプも格納されるようです。 ひえ 03/4/16
--やはり、アーカイブの方法によってフォルダ上書きの確認がされたりされなかったりする気がします。で、その二通りのアーカイブを作成してみたのですが、http://www.geocities.jp/madoinu/xyzzy/pub/packages.txt の中の ese-fortune は、一度インストールした後に、再度同じバージョンをインストールしようとしても何も確認されませんが、chcolor は、インストールしようとするたびに確認されます。これは、アーカイブの中にフォルダのタイムスタンプを持っているがために上書き確認される、とかでしょうか。また、フォルダ上書き確認のときに、「いいえ」を選択すると、「今のところアンインストールを復活することができません。」→「引数が足りません」とメッセージが続き、site-lisp/chcolor/ 以下のファイルがすべて削除されてしまいました。 ひえ
--おっしゃるとおりでタイムスタンプを圧縮時に変更してしまうのが原因のようです。対応していただけるでしょうか。ふかえ
--たぶん、対応しました。list-archive でファイルしか返ってこないと思っていたのが原因でした。いったん別のところに解凍してから移した方がいいんでしょうか？ 服部
---うまくいきました。(^o^) 素早い対応、どうも有り難うございました。ふかえ
--あと、バージョンアップ／再インストール時には、削除してからインストールをするようになっています。で、削除してからエラーが起こった場合などに元に戻すところはまだ作っていませんので、削除されたままになってしまいます。 服部
---了解です。ありがとうございました。 ひえ
----
ページが長くなってきたので、以後は[[NetInstaller]]にて。 服部
