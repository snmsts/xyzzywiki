#freeze
#contents

*dmacroを導入しよう [#decaea23]

**前口上 [#l68cb486]

ちょっと前にキーボードマクロの事を書きましたけど、今回紹介するのはあれに少し似ています。今回紹介するDynamic Macroは、イチイチキー操作を保存せずに二度以上繰り返したキーバインドを半自動的に行ってくれるようにしてくれます。（要は、いつでも直前と、その前のキー操作を覚えておき、それが同様だった場合にだけ行えるキーボードマクロといえばわかりやすいでしょうか?）多分私が説明するよりも、開発された[[増井さんのページ>http://pitecan.com/DynamicMacro/]]を見た方がよく分かると思うので、説明についてはそちらを参照してください。Web上でどんな感じかを体験できるお試しコーナーもあります。

**インストール [#l3af38d9]
***圧縮ファイルから手動でインストールする [#x65be9fb]

dmacroはNetInstallerに対応していないので、アーカイブファイルを元に手動でインストールします。[[大久保さんのサイト>http://www.trick-with.net/]]の[[xyzzyのページ>http://wiki.trick-with.net/xyzzy.html]]から取ってきましょう。dmacro.lのリンクを辿ってください。（連番機能がついた物が欲しい人は、[[kiaさんのWebページ>http://www.geocities.jp/kiaswebsite/xyzzy/ndmacro.html]]にあるndmacro.lを使用するのも手です。ndmacroはNetInstallerから入手できます。）

そうしたら、説明に書かれている通りなのですが、.xyzzyに

 (defconstant *dmacro-key* #\C-o "繰返し指定キー")
 (global-set-key *dmacro-key* 'dmacro-exec)
 (autoload 'dmacro-exec "dmacro" t)

等と書いてください。siteinit.lに書いて再ダンプする場合、再ダンプした直後は動作しますがxyzzyを再起動したときに動かなくなるようです。((私の環境だけかも……。)).xyzzyに書いておいても、ほとんど起動時のタイムロスはないので、そのまま使っています。

2行目がdmacroを実行するキーを指定した箇所です。今回の場合C-oで呼び出せるようになります。キーのカスタマイズについては前回にまとめておいたので参考にしてみてください。これで準備は完了です。

**試す [#p491b7e1]

導入したら適当に試してみてください。多分画像とかいらないと思うので、これだけです。（カスタマイズもキーバインド以外ないと思うので……）例えば、

 おんどりゃぁー
 おんどりゃぁー

とキーボードで打ち込んで、（二回目も改行を忘れずに（忘れてもあまり関係ないが））繰り返しキー（上の場合C-o）を押せば、''おんどりゃぁー''が繰り返されている事を認識した結果、

 おんどりゃぁー
 おんどりゃぁー
 おんどりゃぁー

となります。（IME変換中のタイプミスに関しては（当たり前だけど）無視してくれます。例えば、二回目の「おんどりゃぁー」と打つ途中で、誤って「おんどりゃあー」となった場合でも、IME確定前に「あ」を小さい「ぁ」に変えたならば、繰り返しキーが使用できます。IME確定後の文字列が同じ物ならばいいわけです。）

また、C-hや、C-n、2ストロークキーのC-x C-bでも繰り返せます。F2などの単発のキーでももちろんOKです。
