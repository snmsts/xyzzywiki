[[tips]]

最新版を[[こちら>http://homepage2.nifty.com/kimagurenixyzzy/my-bookmark.html]]に移動しました。

**about [#w9b467ac]

2004-12-19 (日) 10:52:26

須田さんに掲載の許可を頂きました。
改めて須田さんに感謝です。m(__)m

●2ch [Windows板] xyzzy Part10 の792です。
須田さんの bookmark.l を参考にさせて頂いて、
815〜819、826〜827で公開したものにさらに修正を加えてみました。
- テキストにしおりをはさんで、好きな時にその位置にジャンプできるようにするために作りました。グローバルマークと似たようなものですが、テキストを閉じた後も挟んだしおりがクリアされないようになっています。

*インストール方法 [#e8d3e39a]
+ &ref(my-bookmark.l);をコピーして ~/site-lispに my-bookmark.l という名前で保存する。
+ 必要に応じてバイトコンパイルする。
+ .xyzzy または siteinit.l に以下の記述を追加する。
 (require "my-bookmark")
+ siteinit.l に記述した場合は xyzzy を再ダンプする。
+ 以前のものを使用していた場合には、C-c b c で以前のリストを削除して下さい（※2004-10-02 (土) 12:08:02 以降、しおりのリストの形式は変更していないので
それ以降のものを使用されている場合は 5.の手順は不要です）。
*アンインストール方法 [#ic0e773a]
+ M-x my-bookmark-uninstall する。
+ ~/site-lispにある my-bookmark.l（バイトコンパイルした場合は my-bookmark.lc も）を削除する。
+ ~/bookmarklist などのしおりを保存するためのファイルを削除する。
+ siteinit.l や .xyzzy からmy-bookmark.l に関する記述を削除する。
+ siteinit.l に記述していた場合は xyzzy を再ダンプする。

*使い方 [#jc29d142]
- C-c b m（またはS-F2）でジャンプモード、C-c b d で削除モードでメニューを表示する。 
- メニューの一番下の「削除モードにする(&D)」か「ジャンプモードにする(&J)」を選択するとそれぞれのモードに切り替わる（今のモードはステータスバーに表示されます）。
- C-c b a またはメニュー（ジャンプモード）の「しおりをはさむ(A)」を選択すると、現在のバッファのファイル名・行番号（論理行）・行頭から行末までの文字列を取得してメニューに追加する（セレクションがある場合はセレクションの文字列をメニューに追加する。長すぎる場合には左側から指定したバイト数（*bookmark-filename-length*、*bookmark-string-length* で指定）まで表示する）。
- ジャンプモードの時、メニューからしおりを選択すると該当ファイルの該当ポイントにジャンプする。
- 削除モードの時、メニューからしおりを選択すると該当するしおりを削除する。
- C-c b e またはメニューの「編集する(E)」から編集画面を開いて不要な行を削除した後、C-g で、編集終了。
- C-c b p で更新日時順に前にしおりを挟んだ位置（C-c b n で後に挟んだ位置）にジャンプする。
- C-c b s でしおりを保存するファイルの一覧を表示して、それを切り替えることが出来ます（~/.xyzzy などに例えば以下のような設定が必要。この設定をして一覧からファイルを選択すれば該当ファイルは自動生成されます。また、この設定をしなくてもデフォルトで~/bookmarklist というファイルにしおりが保存されます）。
 ;; しおりを保存するファイルのリスト
 (setq *bookmark-list-file-list*
       '(("bookmarklist(&b)" . "~/bookmarklist")
 	("foo(&f)". "~/foo")
 	("bar(&b)" . "~/bar")
 	("lisp(&l)" . "~/lispbm")
  	))

----
-一番重要な何をするためのものかが書いてないです． これはなんですか？ --  &new{2004-04-19 (月) 00:32:41};
-いや、名前通りテキストにしおりをはさんで、別のテキストを編集しているときや、次回起動時にもしおりをはさんだ位置にジャンプできればいいなと思って作ったのですが・・。機能としてはグローバルマークに似ています。 -- [[xyzzy Part10 792]] &new{2004-04-20 (火) 22:22:33};
-あまりに横長で読みにくかったので改行を入れました。また、fileという変数名は一般的過ぎるのでちょっとユニークにしました。 --  &new{2004-04-21 (水) 01:01:53};
-ほとんどパクリなので、自由に編集してもらってかまいません。バグに気づいたら自分でも直すつもりでいます。 -- [[xyzzy Part10 792]] &new{2004-04-21 (水) 01:23:04};

#comment
-----

**Changelog [#xdfda39d]

2004-12-21 (火) 22:15:08

しおりを巡回する処理の高速化（dolistの代わりにmapcを使うように変更）。その他細かい修正など。

（2005-2-6追記 バイトコンパイルせずに計測して勘違いしていたのですが、バイトコンパイルした場合には mapc、lambda を使うよりも dolist を使った方が速いようです。m(_ _)m）

2004-12-19 (日) 10:52:26

- *grep* バッファにしおりを挟んでそのバッファを削除した後に、default-directory が ~/lisp/ のバッファでそのしおりを選択すると ~/lisp/grep.l を開いてしまうなどの問題を修正。
- メニューに２バイト文字を表示するときに右端が文字化けすることがある問題を修正。
- ジャンプの所の処理の見直し。

2004-10-31 (日) 01:09:51
- ファイル名の無いバッファにもしおりを挟めるようにした。
- しおりにジャンプする時に、ヽ催するバッファおよびファイルが存在しないときはそのしおりを削除、△修里靴りに保存されている行番号を現在の行番号に変更、することにした。

2004-10-10 (日) 18:10:59
- ツールバーと、my-bookmark-uninstall を追加。
- 関数名の衝突を避けるため、一部の関数名を変更した。
- 編集の時にバッファに出力されるリストの順番をメニューに表示されるのと同じにした。

2004-10-03 (日) 21:51:08
- 多少の挙動修正をしました。

2004-10-03 (日) 14:59:25
- バッファの最後のポイントよりもしおりに保存してあるポイントの方が大きい場合に、C-c b p(C-c b n)で前（後）のしおりに移動できなくなるバグを修正。

2004-10-03 (日) 12:00:08
- しおりを保存するファイルのリストの設定の仕方を変更しました。

2004-10-02 (土) 18:15:11
- しおりを巡回するときの挙動がおかしかったので修正した。

2004-10-02 (土) 12:08:02
- 行番号にジャンプするのをやめて、ポイント位置にジャンプすることにした。
- レジスタを使うのをやめて、独自にしおりを挟んだ位置を行き来できるようにした（更新日時順）。
- C-c b n（bookmark-add-new-bookmark）のキーバインドを C-c b a に変更しました。
- リストにいくつか項目を追加したので、たびたびすみませんが以前のものを使用していた場合には C-c b c で以前のリストを削除して下さい。m(__)m

2004-08-22 (日) 20:13:10
- 削除モード・ジャンプモードに分けることにした（lisp-mode などとは違います。詳細は使い方を参照してください）。
- 同一ファイルの同一行に挟めるしおりは一つだけにすることにした。
- レジスタを使用して直前にしおりを挟んだ位置に戻れるようにした。
- しおりを保存するファイルを切り替えられるようにした（例えば、lisp用・日本語テキスト用など別々のファイルにしおりを保存して切り替えることができます）。
- 2ch-mode のbookmark-menu と関数名が重なるので、関数bookmark-menu をmy-bookmark-menu に変更した。
- しおりのリストの順番を変えてしまったので、申し訳ないのですが以前のものを使用していた場合には ~/bookmarklist というファイルのバックアップを取るなりした後、C-c b c で以前のリストを削除して下さい。m(__)m

2004-04-25 (日) 10:36:43
- 起動時にしおりのリストを読み込むのをやめて C-c b n 時に読み込むようにした。(-_-) 

2004-04-24 (土) 17:09:13
- xyzzy起動時にしおりのリストを読み込むように変更。
- フルパス名でソートの時、同一ファイル名の場合は行番号順にソートするように変更。

2004-04-23 (金) 23:42:04
- xyzzyの起動直後に C-c b n するとそれまでのリストがクリアされてしまうバグを修正（「(defun bookmark-add-new-bookmark ()」の２行下に (data-read-from-file) を追加しました）。

2004-04-20 (火) 22:44:27
- しおりのリストを ~/usr 以下の .xyzzy.history に保存していたのを、 ~/bookmarklist というファイルに保存することにした（これによりxyzzyを複数起動している場合でも、はさんだしおりがそれぞれに反映されるようになります。環境変数の設定が必要（多分））。
- 「更新日時でソート」を追加した。

- 以前のものを使用していた場合は、
+ C-c b c で以前のリストを削除する<(_ _)>。
+ *scratch*バッファに (unregister-history-variable 'ed::*bookmark-list*) と記述した後で、M-x eval-buffer してEnterを２回押す。
+ 下記のインストール方法に従って、今回修正したものを再インストールする。
- 以上の３つを行ってください。

2004-04-18 (日) 21:46:01
-「;; ソート」の５行下の string-not-greaterp を string-lessp に変更しました。
