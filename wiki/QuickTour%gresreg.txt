#freeze
#contents

*Gresregで一括置換 [#xd9f179e]

**前口上 [#sc1265c9]

今回はGresregの話です。実は前回のGrepと見た目的にはそっくりです。違うところはわかりやすくて、Grepは色々なファイル（やxyzzyで開いたファイル）を一気に検索するものでしたけど、Gresregは検索したところを置換することが出来ます。要は、Grepでヒットした箇所を置換するという所が違います。

いつものように本題に入る前に少しキーバインドの話を。
アンドゥ、リドゥは、それぞれC-\、C-_です。((メニューに載っているから分かると思うけど。))ちなみにリドゥは、F12でも出来ます。

**Gresregの説明を [#ld4231c8]

では本題に入ります。
Gresregってのは、前に書いたように、ファイルを一括に検索して、該当箇所を置換する機能です。これにもダイアログ版とミニバッファ版の二つあるようです。

とりあえずダイアログ版を起動してみます。メニューバーから、''検索（S）→Gresreg（S）...''を選びます。すると、以下のダイアログが現れると思います。

#br
#br

CENTER:''Gresregのダイアログを表示させた''
CENTER:#ref(01.png,center,100%)
CENTER:#img(,clear)
CENTER:&size(10){ま、そのまんまなんですが。};

#br
#br

なんか雰囲気がGrepのダイアログと似ていますね。違うところは置換する文字列を入れる所がある点と、オプションが少し違うところくらい。
前回Grepの時に使ったファイルたちを使って、実際にGresregを試して見ましょう。

検索の欄に阪神を、置換の欄に、イチローとか入れてみます。ファイルマスクは*.txtで、オプションはとりあえず何もチェックしないでおきます。

#br
#br

CENTER:''検索語、置換語を挿入する''
CENTER:#ref(02.png,center,100%)
CENTER:#img(,clear)
CENTER:&size(10){他の単語でも（ファイルの中にあれば）OKです。};

#br
#br

二つボタンがありますね。一応今回は 確認あり（Q）のほうで行ってみましょうか。

すると、該当箇所を見つけると、xyzzyで表示されて、置換するかしないかを聞いてきます。yを押すと置換、nを押すと置換されずに次の箇所へと飛んで行きます。今回はとりあえず練習なので、全部yを押してみました。

#br
#br

CENTER:''確認あり(Q）だとこんな感じ''
CENTER:#ref(03.png,center,100%)
CENTER:#img(,clear)
CENTER:&size(10){ちなみに全て置換（A）だと、xyzzyがいちいち聞いてこないで、（一気に）該当箇所を全部置換します。};

#br
#br

終わったら、こんな感じになっていると思います。

#br
#br

CENTER:''置換してみた結果''
CENTER:#ref(04.png,center,100%)
CENTER:#img(,clear)
CENTER:&size(10){バッファタブの所に*マークが表示されていますね。まだセーブされていません。一応断っておくけど、見やすいようにウィンドウを分割してます。};

#br
#br

xyzzyがファイルを開いて、該当箇所（阪神）をイチローに換えてくれました。Grepとは違って、*Grep*みたいな新しいタブは出ません。((当たり前かも。))

ちなみに、置換されたファイルはまだ保存されていませんね。これはオプションの勝手にセーブしろ（V）をチェックすると、（名前の通り）自動で保存してくれます。
（まぁ、自動で保存してくれなくても、M-x save-all-buffersで後からでも一気に保存も出来るから、あんまり問題では無いような気がするけど）

**オプションの説明（はしません） [#mff756b7]

Gresregのオプションは、実は上で説明した''勝手にセーブしろ（V）以外は全部Grepのオプションとおんなじ''みたいです。だから、説明はしません。[[Grepの所>QuickTour/grep#md5746f2]]で説明していますので、そちらをご覧下さい。

ちなみにGresregは（Grepと同様に）、 ミニバッファ版もあります。これもあんまり変わらないし、（自分も今回書くときにはじめて知ったくらいなので）これも説明しなくても良いと思うんだけど……。まぁ一応説明しておきますと、M-x gresregと入力すると使えます。Grepのミニバッファ版と同様に、開いているファイルを対象とする点がダイアログ版と大きく異なる点でしょうか。

**注意とか。 [#yc2e543b]

以上で大体説明はおしまい。簡単な説明だったなぁ。

ちなみにGresregの際に注意する点があります。以下の四点です。

- 置換する前のファイルを必ずバックアップするように（間違った時大変だから(^^;;）
- （さらに出来れば事前に）共通設定ダイアログのバックアップファイルを作るにチェックを入れておく
- ファイルマスクは適当に指定しないようにする、もしくは、拡張子毎にフォルダを移すとかする（慣れないうちは）
- （Grepと同様に）ファイルによってはうまく文字コードの認識がされない事があるので確認をする

特に重要なのは、バックアップを取る事でしょうね。Gresregは間違って指定した時に取り返しがつかないので、慣れるまではバックアップを取ることをお忘れなく。

**「送る」でGresregダイアログを出したい！！ [#mfc0d317]

という私みたいな酔狂な人のために、そのやり方を書きます。

前回のGrepの時みたいにWikiにあるのかもしれませんが、よく調べてません :p [[黒い羽根さんのページのGrepのやつ:http://www.uranus.dti.ne.jp/~shiro-/soft/xyzzy/search.html#outside]]を利用して、とりあえず自分は以下をsiteinit.lに書いて、関数の呼び出しを利用しています。（自分で言うのもなんだけど）ちょっと面倒くさい方法ですね。Lispが分かる人なら、もっと簡単に出来るのかもしれません。

  ;; 送るからgresregを使う
  (defun my-gresreg ()
    (require "gresregd")
    (let ((ed::*gresreg-directory-name-hook*
         #'(lambda ()
             (pop si:*command-line-args*))))
      (declare (special ed::*gresreg-directory-name-hook*))
      (gresreg-dialog)))

上のソースを、.xyzzyかsiteinit.lに記述したら、xyzzycli.exe((やxyzzy.exe))のショートカットのプロパティを以下のように指定します。

#br
#br

CENTER:''ショートカットの設定（プロパティから行います）''
CENTER:#ref(05.png,center,100%)
CENTER:#img(,clear)

#br
#br

見て分かると思いますが、xyzzyのパスの後に、

 -f my-gresreg

と入力してください。

自分はエクスプローラの「送る」に入れてあります。上記の指定をして、フォルダを送ってみるとGresregダイアログが出ます。あんまりgresregをがんがん使うことは無いので、実際使ったことは２、３度位しかないんですけど。 :p 

**Gresregはこのくらいにして [#ib6c4625]

今回はGrepを前提として書いてあるので、Grepを読まないでこれだけを読んでいたりしたら、ぜんぜんわかんないかもしれません。

一括置換はその手のソフトも幾つかあるから、xyzzy以外でやっても良い様な気がするなぁ。((文字コードの認識や後方参照とかが他に無い強みでしょうね。きっと。))

次回はabbrevとdabbrevですね。これはすごい！！ いわゆる自動補完機能なんですが、日本語も対象にやってくれるエディタってあんまり無いと思います。
